<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pro QR Reader & Generator</title>
  <meta name="description" content="A professional, fully client-side QR code generator and reader (camera + image upload)." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='18' fill='%23111'/%3E%3Cpath d='M12 12h28v28H12zM60 12h28v28H60zM12 60h28v28H12zM60 60h12v12H60zM78 60h10v10H78zM72 78h16v10H72z' fill='%23fff'/%3E%3C/svg%3E"/>
  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
  <style>
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .card { box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1); }
    .grid-auto-fit { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
  </style>
  <!-- QR Generation -->
  <script defer src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <!-- QR Scanning (ZXing UMD build to expose global `ZXing`) -->
  <script defer src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.0/umd/index.min.js"></script>
</head>
<body class="h-full bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100">
  <header class="sticky top-0 z-30 bg-white/80 dark:bg-gray-900/80 backdrop-blur border-b border-gray-200 dark:border-gray-800">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-2xl bg-gray-900 text-white dark:bg-white dark:text-gray-900 grid place-items-center font-bold">QR</div>
        <h1 class="text-xl sm:text-2xl font-semibold tracking-tight">Pro QR Reader & Generator</h1>
      </div>
      <div class="flex items-center gap-2">
        <button id="btn-dark" class="text-sm px-3 py-1.5 rounded-xl border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800">üåô/‚òÄÔ∏è</button>
        <span id="https-tip" class="hidden text-xs px-3 py-1.5 rounded-xl bg-amber-100 text-amber-900 dark:bg-amber-900/30 dark:text-amber-200">Use HTTPS for camera</span>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6 md:py-10">
    <!-- Tabs -->
    <div class="mb-6">
      <div class="inline-flex rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950 p-1 card">
        <button id="tab-generate" class="tab px-4 md:px-6 py-2.5 rounded-xl text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-800 active">Generate</button>
        <button id="tab-scan" class="tab px-4 md:px-6 py-2.5 rounded-xl text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-800">Scan</button>
      </div>
    </div>

    <!-- GENERATE PANEL -->
    <section id="panel-generate" class="grid md:grid-cols-2 gap-6">
      <!-- Controls -->
      <div class="card bg-white dark:bg-gray-950 rounded-3xl p-5 md:p-6">
        <h2 class="text-lg font-semibold mb-4">Create a QR Code</h2>
        <div class="space-y-4">
          <label class="block">
            <span class="text-sm font-medium">Content</span>
            <textarea id="qr-text" class="mt-1 w-full rounded-xl border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:border-gray-900 dark:focus:border-white focus:ring-gray-900 dark:focus:ring-white min-h-[140px]" placeholder="Text, URL, Wi‚ÄëFi string, vCard, etc."></textarea>
          </label>

          <div class="grid grid-auto-fit gap-4">
            <label class="block">
              <span class="text-sm font-medium">Size (px)</span>
              <input id="qr-size" type="number" min="128" max="1024" value="320" class="mt-1 w-full rounded-xl border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:border-gray-900 dark:focus:border-white focus:ring-gray-900 dark:focus:ring-white" />
            </label>
            <label class="block">
              <span class="text-sm font-medium">Margin (px)</span>
              <input id="qr-margin" type="number" min="0" max="24" value="8" class="mt-1 w-full rounded-xl border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:border-gray-900 dark:focus:border-white focus:ring-gray-900 dark:focus:ring-white" />
            </label>
            <label class="block">
              <span class="text-sm font-medium">Foreground</span>
              <input id="qr-fore" type="color" value="#111111" class="mt-1 w-full rounded-xl border-gray-300 dark:border-gray-700 h-10 bg-white dark:bg-gray-900" />
            </label>
            <label class="block">
              <span class="text-sm font-medium">Background</span>
              <input id="qr-back" type="color" value="#FFFFFF" class="mt-1 w-full rounded-xl border-gray-300 dark:border-gray-700 h-10 bg-white dark:bg-gray-900" />
            </label>
            <label class="block">
              <span class="text-sm font-medium">Error Correction</span>
              <select id="qr-ecc" class="mt-1 w-full rounded-xl border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:border-gray-900 dark:focus:border-white focus:ring-gray-900 dark:focus:ring-white">
                <option value="L">L (Low)</option>
                <option value="M" selected>M (Medium)</option>
                <option value="Q">Q (Quartile)</option>
                <option value="H">H (High)</option>
              </select>
            </label>
            <label class="block">
              <span class="text-sm font-medium">Template</span>
              <select id="qr-template" class="mt-1 w-full rounded-xl border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:border-gray-900 dark:focus:border-white focus:ring-gray-900 dark:focus:ring-white">
                <option value="">None</option>
                <option value="wifi">Wi‚ÄëFi</option>
                <option value="vcard">vCard</option>
                <option value="sms">SMS</option>
                <option value="email">Email</option>
                <option value="geo">Geo</option>
              </select>
            </label>
          </div>

          <div class="flex flex-wrap gap-3 pt-2">
            <button id="btn-generate" class="px-4 py-2 rounded-xl bg-gray-900 text-white hover:bg-black disabled:opacity-40 disabled:cursor-not-allowed">Generate</button>
            <button id="btn-download" class="px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800" disabled>Download PNG</button>
            <button id="btn-copy" class="px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800" disabled>Copy Image</button>
            <button id="btn-clear" class="px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800">Clear</button>
          </div>
          <p class="text-xs text-gray-500 dark:text-gray-400">Wi‚ÄëFi format: <code>WIFI:T:WPA;S:mynetwork;P:mypass;;</code> ‚Ä¢ vCard example and other templates available via the Template dropdown.</p>
        </div>
      </div>

      <!-- Preview -->
      <div class="card bg-white dark:bg-gray-950 rounded-3xl p-5 md:p-6 flex flex-col items-center justify-center min-h-[420px]">
        <div id="qr-preview" class="rounded-2xl border border-dashed border-gray-300 dark:border-gray-700 p-4 grid place-items-center min-h-[360px] w-full"></div>
      </div>
    </section>

    <!-- SCAN PANEL -->
    <section id="panel-scan" class="hidden grid lg:grid-cols-3 gap-6">
      <!-- Live Scanner -->
      <div class="card bg-white dark:bg-gray-950 rounded-3xl p-5 md:p-6 lg:col-span-2">
        <h2 class="text-lg font-semibold mb-4">Scan with Camera</h2>
        <div class="grid md:grid-cols-2 gap-3 mb-3">
          <label class="block">
            <span class="text-sm font-medium">Camera</span>
            <select id="camera-select" class="mt-1 w-full rounded-xl border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:border-gray-900 dark:focus:border-white focus:ring-gray-900 dark:focus:ring-white"></select>
          </label>
          <div class="flex items-end gap-3">
            <button id="btn-start" class="px-4 py-2 rounded-xl bg-gray-900 text-white hover:bg-black">Start</button>
            <button id="btn-stop" class="px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800" disabled>Stop</button>
            <button id="btn-torch" class="px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800" disabled>Torch</button>
            <label class="text-sm flex items-center gap-2 ml-2"><input id="pause-on-result" type="checkbox" class="rounded" checked> Pause on result</label>
          </div>
        </div>
        <div class="rounded-2xl overflow-hidden border border-gray-200 dark:border-gray-800 aspect-video bg-black grid place-items-center">
          <video id="preview" class="w-full h-full object-cover" playsinline muted></video>
        </div>
        <p id="scan-status" class="mt-2 text-sm text-gray-600 dark:text-gray-400">Idle.</p>
      </div>

      <!-- Image Upload -->
      <div class="card bg-white dark:bg-gray-950 rounded-3xl p-5 md:p-6">
        <h2 class="text-lg font-semibold mb-4">Scan from Image</h2>
        <input id="file" type="file" accept="image/*" class="block w-full text-sm file:mr-3 file:py-2 file:px-3 file:rounded-xl file:border-0 file:bg-gray-900 file:text-white hover:file:bg-black" />
        <button id="btn-scan-img" class="mt-3 px-4 py-2 rounded-xl bg-gray-900 text-white hover:bg-black disabled:opacity-40">Scan Now</button>
        <img id="img-preview" alt="" class="mt-3 hidden rounded-xl border border-gray-200 dark:border-gray-800" />
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">Drag & drop also works.</p>
      </div>

      <!-- Results -->
      <div class="lg:col-span-3 card bg-white dark:bg-gray-950 rounded-3xl p-5 md:p-6">
        <h2 class="text-lg font-semibold mb-4">Result</h2>
        <div class="flex flex-wrap gap-3 mb-3">
          <button id="btn-copy-text" class="px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800" disabled>Copy Text</button>
          <a id="btn-open" class="px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 pointer-events-none opacity-50" target="_blank">Open as URL</a>
          <button id="btn-share" class="px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800" disabled>Share</button>
          <button id="btn-clear-result" class="px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800">Clear</button>
        </div>
        <textarea id="result" readonly class="w-full rounded-xl border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:border-gray-900 dark:focus:border-white focus:ring-gray-900 dark:focus:ring-white min-h-[140px]"></textarea>
      </div>
    </section>

    <footer class="mt-10 text-center text-xs text-gray-500 dark:text-gray-400">
      100% client‚Äëside. Works offline after first load. Best on HTTPS (GitHub Pages is HTTPS by default).
    </footer>
  </main>

  <script>
  // Run after DOM is parsed AND after deferred ZXing UMD is ready
  window.addEventListener('DOMContentLoaded', () => {
    // ---- Dark mode toggle ----
    const root = document.documentElement;
    const darkBtn = document.getElementById('btn-dark');
    function setDark(v){ v ? root.classList.add('dark') : root.classList.remove('dark'); localStorage.setItem('qr.dark', v ? '1':'0'); }
    setDark(localStorage.getItem('qr.dark') === '1');
    darkBtn.addEventListener('click', ()=> setDark(!root.classList.contains('dark')));

    // HTTPS tip (camera requires secure context on most browsers)
    const httpsTip = document.getElementById('https-tip');
    if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
      httpsTip.classList.remove('hidden');
    }

    // ---- Tabs ----
    const tabGen = document.getElementById('tab-generate');
    const tabScan = document.getElementById('tab-scan');
    const panelGen = document.getElementById('panel-generate');
    const panelScan = document.getElementById('panel-scan');
    function activate(tab){
      if(tab==='gen'){
        tabGen.classList.add('active','bg-gray-900','text-white');
        tabScan.classList.remove('active','bg-gray-900','text-white');
        panelGen.classList.remove('hidden');
        panelScan.classList.add('hidden');
      } else {
        tabScan.classList.add('active','bg-gray-900','text-white');
        tabGen.classList.remove('active','bg-gray-900','text-white');
        panelScan.classList.remove('hidden');
        panelGen.classList.add('hidden');
      }
    }
    tabGen.addEventListener('click',()=>activate('gen'));
    tabScan.addEventListener('click',()=>activate('scan'));

    // ---- Generator ----
    const txt = document.getElementById('qr-text');
    const size = document.getElementById('qr-size');
    const margin = document.getElementById('qr-margin');
    const fore = document.getElementById('qr-fore');
    const back = document.getElementById('qr-back');
    const ecc  = document.getElementById('qr-ecc');
    const template = document.getElementById('qr-template');
    const prev = document.getElementById('qr-preview');
    const btnGen = document.getElementById('btn-generate');
    const btnDl  = document.getElementById('btn-download');
    const btnCp  = document.getElementById('btn-copy');
    const btnCl  = document.getElementById('btn-clear');

    function clearPreview(){
      prev.innerHTML = '<div class="text-sm text-gray-400">Your QR code will appear here</div>';
      btnDl.disabled = true; btnCp.disabled = true;
    }

    function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

    function makeQR(){
      const content = txt.value.trim();
      if(!content){ clearPreview(); return; }
      prev.innerHTML = '';
      new QRCode(prev, {
        text: content,
        width: clamp(Number(size.value)||320, 128, 1024),
        height: clamp(Number(size.value)||320, 128, 1024),
        colorDark: fore.value || '#111111',
        colorLight: back.value || '#FFFFFF',
        correctLevel: QRCode.CorrectLevel[ecc.value] || QRCode.CorrectLevel.M,
      });
      prev.style.padding = `${clamp(Number(margin.value)||0,0,24)}px`;
      setTimeout(()=>{ btnDl.disabled=false; btnCp.disabled=false; }, 120);
    }

    btnGen.addEventListener('click', makeQR);
    btnDl.addEventListener('click',()=>{
      const canvas = prev.querySelector('canvas');
      if(!canvas) return;
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      a.download = `qr-${Date.now()}.png`;
      a.click();
    });
    btnCp.addEventListener('click',()=>{
      const canvas = prev.querySelector('canvas');
      if(!canvas) return;
      canvas.toBlob(async (blob)=>{
        try{
          await navigator.clipboard.write([ new ClipboardItem({ [blob.type]: blob }) ]);
          flash(btnCp, 'Copied!');
        }catch(e){ alert('Clipboard not available: '+e.message); }
      });
    });
    btnCl.addEventListener('click',()=>{ txt.value=''; clearPreview(); });

    // Templates
    template.addEventListener('change', async (e)=>{
      const t = e.target.value;
      if(!t) return;
      if(t==='wifi'){
        const ssid = prompt('Wi‚ÄëFi SSID (network name):','');
        const sec = prompt('Security (WEP/WPA/nopass):','WPA');
        const pass = sec==='nopass' ? '' : prompt('Password:','');
        if(ssid!==null && sec!==null && pass!==null){
          txt.value = `WIFI:T:${sec};S:${ssid};P:${pass};;`;
        }
      } else if(t==='vcard'){
        const fn = prompt('Full name:','Jane Doe')||'';
        const org = prompt('Organization:','')||'';
        const tel = prompt('Phone:','')||'';
        const email = prompt('Email:','')||'';
        txt.value = `BEGIN:VCARD\nVERSION:3.0\nFN:${fn}\nORG:${org}\nTEL:${tel}\nEMAIL:${email}\nEND:VCARD`;
      } else if(t==='sms'){
        const num = prompt('Phone number:','')||'';
        const msg = prompt('Message:','')||'';
        txt.value = `SMSTO:${num}:${msg}`;
      } else if(t==='email'){
        const to = prompt('To:','')||'';
        const subject = encodeURIComponent(prompt('Subject:','')||'');
        const body = encodeURIComponent(prompt('Body:','')||'');
        txt.value = `MAILTO:${to}?subject=${subject}&body=${body}`;
      } else if(t==='geo'){
        const lat = prompt('Latitude:','');
        const lng = prompt('Longitude:','');
        if(lat && lng) txt.value = `geo:${lat},${lng}`;
      }
      e.target.value = '';
    });

    clearPreview();

    // ---- Scanner ----
    if (!window.ZXing) {
      console.error('ZXing failed to load.');
    }
    const codeReader = new ZXing.BrowserMultiFormatReader();
    const video = document.getElementById('preview');
    const cameraSelect = document.getElementById('camera-select');
    const btnStart = document.getElementById('btn-start');
    const btnStop  = document.getElementById('btn-stop');
    const btnTorch = document.getElementById('btn-torch');
    const pauseOnResult = document.getElementById('pause-on-result');
    const statusEl = document.getElementById('scan-status');
    const resultEl = document.getElementById('result');
    const btnCopyText = document.getElementById('btn-copy-text');
    const btnOpen = document.getElementById('btn-open');
    const btnShare = document.getElementById('btn-share');
    const btnClearResult = document.getElementById('btn-clear-result');
    const fileInput = document.getElementById('file');
    const imgPreview = document.getElementById('img-preview');
    const btnScanImg = document.getElementById('btn-scan-img');

    let currentStream = null;
    let scanningActive = false;

    async function listCameras(){
      try{
        const devices = await codeReader.listVideoInputDevices();
        cameraSelect.innerHTML = '';
        devices.forEach((d,i)=>{
          const opt = document.createElement('option');
          opt.value = d.deviceId; opt.textContent = d.label || `Camera ${i+1}`;
          cameraSelect.appendChild(opt);
        });
        if(devices.length===0){
          const opt = document.createElement('option'); opt.textContent='No camera found'; cameraSelect.appendChild(opt);
        }
      }catch(e){ cameraSelect.innerHTML = `<option>Error listing cameras</option>`; }
    }

    function handleResult(text){
      resultEl.value = text;
      const has = !!text && !/^No QR code/.test(text);
      btnCopyText.disabled = !text;
      btnShare.disabled = !has || !navigator.share;
      try{ const u = new URL(text); btnOpen.href = u.href; btnOpen.classList.remove('pointer-events-none','opacity-50'); }
      catch(_){ btnOpen.href = '#'; btnOpen.classList.add('pointer-events-none','opacity-50'); }
      if(has) beep();
      if (has && pauseOnResult.checked) {
        scanningActive = false; statusEl.textContent = 'Paused (result captured).';
      }
    }

    function startScanner(){
      statusEl.textContent = 'Requesting camera‚Ä¶';
      btnStart.disabled = true; btnStop.disabled = false;
      scanningActive = true;
      // iOS/safari inline playback
      video.setAttribute('playsinline','');
      video.muted = true;

      const deviceId = cameraSelect.value || undefined;
      
      // First request camera permission
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(() => {
          // Now start the scanner after permissions are granted
          // DO NOT await here; ZXing manages the stream and invokes the callback repeatedly
          codeReader.decodeFromVideoDevice(deviceId, video, (result, err) => {
            if(!scanningActive) return;
            if(result){ handleResult(result.getText()); }
            if(err && !(err instanceof ZXing.NotFoundException)){
              console.warn(err);
            }
          }).catch(e => {
            statusEl.textContent = 'Camera error: ' + e.message + ' (Did you allow permissions?)';
            btnStart.disabled = false; btnStop.disabled = true; btnTorch.disabled = true;
          });

          // when the video gets a stream, detect torch capability
          video.addEventListener('loadedmetadata', () => {
            const track = video.srcObject && video.srcObject.getVideoTracks ? video.srcObject.getVideoTracks()[0] : null;
            const capabilities = track && track.getCapabilities ? track.getCapabilities() : {};
            btnTorch.disabled = !capabilities || !capabilities.torch;
            statusEl.textContent = 'Scanning‚Ä¶ point at a QR code.';
            currentStream = video.srcObject || null;
          }, { once: true });
        })
        .catch(e => {
          statusEl.textContent = 'Camera access denied: ' + e.message;
          btnStart.disabled = false;
          scanningActive = false;
        });
    }

    function stopScanner(){
      scanningActive = false;
      try{ codeReader.reset(); }catch(_){}
      if(currentStream){ currentStream.getTracks().forEach(t=>t.stop()); currentStream=null; }
      if(video.srcObject){
        try { video.srcObject.getTracks().forEach(t=>t.stop()); } catch(_) {}
        video.srcObject = null;
      }
      btnStop.disabled = true; btnStart.disabled = false; btnTorch.disabled = true;
      statusEl.textContent = 'Stopped.';
    }

    btnStart.addEventListener('click', startScanner);
    btnStop.addEventListener('click', stopScanner);

    cameraSelect.addEventListener('change', () => {
      if (scanningActive) { stopScanner(); setTimeout(startScanner, 50); }
    });

    btnTorch.addEventListener('click', ()=>{
      if(!video.srcObject) return;
      const track = video.srcObject.getVideoTracks()[0];
      const capabilities = track.getCapabilities ? track.getCapabilities() : {};
      if(!capabilities.torch) return;
      const settings = track.getSettings();
      track.applyConstraints({ advanced: [{ torch: !settings.torch }] });
    });

    // Populate cameras on load/visibility
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) listCameras(); });
    if(navigator.mediaDevices?.enumerateDevices){ listCameras(); }

    // Image scanning (uses the same MultiFormat reader)
    let uploadedFileUrl = null;
    fileInput.addEventListener('change',(e)=>{
      const file = e.target.files?.[0]; if(!file) return;
      if(uploadedFileUrl) URL.revokeObjectURL(uploadedFileUrl);
      uploadedFileUrl = URL.createObjectURL(file);
      imgPreview.src = uploadedFileUrl; imgPreview.classList.remove('hidden');
    });

    btnScanImg.addEventListener('click', async ()=>{
      if(!uploadedFileUrl){ alert('Please upload an image first.'); return; }
      try{
        const img = await loadImg(uploadedFileUrl);
        const res = await codeReader.decodeFromImage(img);
        handleResult(res.text || '');
      }catch(err){ handleResult('No QR code detected in image.'); }
    });

    function loadImg(url){
      return new Promise((resolve,reject)=>{ const i=new Image(); i.onload=()=>resolve(i); i.onerror=reject; i.src=url; });
    }

    // Drag & drop support
    const uploadCard = fileInput.closest('.card');
    uploadCard.addEventListener('dragover', e=>{ e.preventDefault(); uploadCard.classList.add('ring-2','ring-gray-900'); });
    uploadCard.addEventListener('dragleave', ()=> uploadCard.classList.remove('ring-2','ring-gray-900'));
    uploadCard.addEventListener('drop', e=>{
      e.preventDefault(); uploadCard.classList.remove('ring-2','ring-gray-900');
      if(e.dataTransfer.files && e.dataTransfer.files[0]){ fileInput.files = e.dataTransfer.files; fileInput.dispatchEvent(new Event('change')); }
    });

    // Result helpers
    btnCopyText.addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(resultEl.value); flash(btnCopyText,'Copied!'); }catch(e){ alert('Clipboard not available: '+e.message); }
    });
    btnShare.addEventListener('click', async ()=>{
      if(!navigator.share) return; try{ await navigator.share({ text: resultEl.value }); }catch(_){ }
    });
    btnClearResult.addEventListener('click', ()=> handleResult(''));

    function flash(btn, text){ const t = btn.textContent; btn.textContent = text; btn.disabled = true; setTimeout(()=>{ btn.textContent=t; btn.disabled=false; }, 900); }
    function beep(){ try{ const ctx = new (window.AudioContext||window.webkitAudioContext)(); const o = ctx.createOscillator(); const g = ctx.createGain(); o.connect(g); g.connect(ctx.destination); o.type='sine'; o.frequency.value=880; g.gain.setValueAtTime(0.001, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime+0.01); o.start(); setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime+0.15); o.stop(ctx.currentTime+0.2); }, 30); }catch(_){}}
  });
  </script>
</body>
</html>
